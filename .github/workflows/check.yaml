name: Code Quality Check

on:
  pull_request:
  push:
    branches:
      - main

jobs:
  quality-check:
    name: Run Quality Checks
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install Hatch
        run: pip install hatch

      - name: Install MeCab
        run: |
          sudo apt-get update
          sudo apt-get install -y mecab libmecab-dev mecab-ipadic-utf8
          sudo ln -s /etc/mecabrc /usr/local/etc/mecabrc

      # 1. 静的解析 & フォーマットチェック (Ruff)
      - name: Run Ruff via Hatch
        run: hatch fmt --check

      # 2. 型チェック (Pyright)
      - name: Run Pyright
        run: hatch run check

      # 3. テストの実行 (pytest)
      - name: Run Tests via Hatch
        run: hatch test