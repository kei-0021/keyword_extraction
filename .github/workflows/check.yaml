name: Code Quality Check

on:
  pull_request:
  push:
    branches:
      - main

jobs:
  quality-check:
    name: Run Quality Checks
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install Hatch
        run: pip install hatch

      # 1. 型チェック (Pyright)
      - name: Run Pyright
        run: hatch run check

      # 2. 静的解析 & フォーマットチェック (Ruff)
      # hatch fmt --check は修正を行わず、ルール違反がある場合にエラーを返します
      - name: Run Ruff via Hatch
        run: hatch fmt --check

      # 3. シェルスクリプトのチェック (もし必要なら)
      - name: Run shellcheck
        run: |
          sudo apt-get update && sudo apt-get install -y shellcheck
          find . -type f -name "*.sh" -exec shellcheck {} +